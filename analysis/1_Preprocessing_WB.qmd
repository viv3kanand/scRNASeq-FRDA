---
title: "1. Preprocessing - scRNA-Seq - FRDA (Whole Blood)"
format: html
editor: source
author: viv3kanand
---

## Package dependencies

```{r}
# renv::install("tidyverse")
# renv::install("Seurat")
```

### Load required libraries

```{r}
#| echo: false
#| include: false
#| message: false
#| warning: false

require(tidyverse)
require(Seurat)
```

## Process data

### Load data

```{r}
#| echo: true

li_WB <- list.files("../data/")

purrr::imap(setNames(li_WB, li_WB), function(obj, name){
  Seurat::Read10X(paste0("../data/", obj)) |> 
    Seurat::CreateSeuratObject(min.cells = 3,
                               project = name)
}) -> seurat_list

```

### Filter and merge

```{r}
source("../scripts/helper_scripts.R")
```


```{r}
# Filter cells with empirical cut off
seurat_list <- seurat_list |> map(filterCell)

# remove sample failed to QC
# seurat_list$O3_Patient <- NULL

# Merge datasets
seurat_obj <- reduce(seurat_list, merge) |>
  JoinLayers()  #https://github.com/satijalab/seurat/issues/7316

meta.data <- seurat_obj@meta.data |> 
  merge(meta, by = "orig.ident", all.x = TRUE)

seurat_obj <- seurat_obj |> 
  AddMetaData(metadata = meta.data)
```






















