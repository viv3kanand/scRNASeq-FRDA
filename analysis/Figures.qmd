---
title: "Figures"
format: html
editor: source
author: viv3kanand
---

## Load libraries

```{r}
#| label: packages
#| echo: true
#| eval: true
#| message: false
#| warning: false

require(Seurat)
require(DropletUtils)
require(tidyverse)
require(MetBrewer)
require(ggpointdensity)
require(scico)
```

```{r}
#| echo: false
#| eval: true

seurat_obj <- read_rds("../data/2024-10-14_seurat_WB.rds")

```

## Load data

```{r}
#| label: load data
#| echo: true
#| eval: false

seurat_obj <- read_rds(paste0("RData/", Sys.Date(), "_seurat_WB.rds"))

```

## Helper scripts

```{r}
#| label: source helper scripts
#| echo: true
#| eval: true

source("../scripts/helper_scripts.R")

```

## QC

### Library saturation

```{r}
#| label: saturation
#| echo: true
#| eval: true
#| fig-width: 10
#| fig-height: 7
#| fig-align: center

ggplot(seurat_list$C2_Control@meta.data, aes(nCount_RNA, nFeature_RNA)) +
    geom_bin2d(bins = 50) +
    MetBrewer::scale_fill_met_c(palette = "Hiroshige", direction = -1) +
    scale_x_log10(guide = "axis_logticks") + scale_y_log10(guide = "axis_logticks") +
    labs(x = "Total UMI counts", y = "Number of genes detected")

```

### Knee plot

```{r}
#| label: knee plot
#| echo: true
#| eval: true
#| fig-width: 10
#| fig-height: 7
#| fig-align: center

knee_plot(barcodeRanks(seurat_list$C2_Control[["RNA"]]$counts, lower = 10))

```



```{r}
ggplot(seurat_obj@meta.data, aes(nCount_RNA, percent.mt)) +
  geom_pointdensity() +
  scale_color_scico(palette = "devon", direction = -1, end = 0.9) +
  labs(x = "Total UMI counts", y = "Percentage mitochondrial")

```


```{r}
p1 <- seurat_obj@meta.data |> 
    ggplot(aes(color = Condition, x = nFeature_RNA  , fill = Condition)) + 
    geom_density(alpha = 0.2) + 
    scale_x_log10() + 
    theme_classic() +
    ylab("Density") +
    geom_vline(xintercept = 500)

p2 <- seurat_obj@meta.data |> 
    ggplot(aes(color = Condition, x = nCount_RNA , fill = Condition)) + 
    geom_density(alpha = 0.2) + 
    scale_x_log10() + 
    theme_classic() +
    ylab("Density") +
    geom_vline(xintercept = 500)

p3 <- seurat_obj@meta.data |> 
    ggplot(aes(color = Condition, x = percent.mt, fill = Condition)) + 
    geom_density(alpha = 0.2) + 
    #scale_x_log10() + 
    theme_classic() +
    geom_vline(xintercept = c(5, 10))

p4 <- FeatureScatter(seurat_obj, feature1 = "nCount_RNA", feature2 = "nFeature_RNA") & NoLegend()

p1 + p2 + p3 + p4
```


















